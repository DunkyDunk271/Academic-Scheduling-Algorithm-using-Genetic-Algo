<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Academic Calendar</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.css" />
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/gcal.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/locale-all.js"></script>
  <script>
  $(document).ready(function() {
    var calendar = $('#calendar').fullCalendar({
        editable: true,
        header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,agendaWeek,agendaDay,listMonth,listWeek,listDay'
        },
        views: {
            listMonth: { buttonText: 'List Month' },
            listWeek: { buttonText: 'List Week' },
            listDay: { buttonText: 'List Day' }
        },
        events: [
            {% for row in calendar %}
            {
                id: '{{row.id}}',
                title: '{{row.course}} - Prof: {{row.professor}} - Room: {{row.room}}',
                start: '{{row.start}}',
                end: '{{row.end}}',
                professor: '{{row.professor}}',
                room: '{{row.room}}'
            },
            {% endfor %}
        ],
        selectable: true,
        selectHelper: true,
        select: function(start, end, allDay) {
            var course = prompt("Enter Course Name");
            var profname = prompt("Enter Professor Name");
            var classroom = prompt("Enter Classroom");
            if (course && profname && classroom) {
                var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
                var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
                $.ajax({
                    url: "/insert",
                    type: "POST",
                    data: {
                        course: course,
                        start: start,
                        end: end,
                        profname: profname,
                        classroom: classroom
                    },
                    success: function(data) {
                        alert("Added Successfully");
                        window.location.replace("/");
                    }
                });
            }
        },
        editable: true,
        eventResize: function(event) {
            var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
            var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
            var course = event.course.split(' - ')[0]; // Extracting title from formatted string
            var profname = event.profname;
            var classroom = event.room;
            var id = event.id;
            $.ajax({
                url: "/update",
                type: "POST",
                data: {
                    course: course,
                    start: start,
                    end: end,
                    profname: profname,
                    classroom: classroom,
                    id: id
                },
                success: function() {
                    calendar.fullCalendar('refetchEvents');
                    alert('Event Updated');
                }
            });
        },
        eventDrop: function(event) {
            var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
            var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
            var course = event.course.split(' - ')[0]; // Extracting title from formatted string
            var profname = event.profname;
            var classroom = event.room;
            var id = event.id;
            $.ajax({
                url: "/update",
                type: "POST",
                data: {
                    title: title,
                    start: start,
                    end: end,
                    profname: profname,
                    classroom: classroom,
                    id: id
                },
                success: function() {
                    calendar.fullCalendar('refetchEvents');
                    alert("Event Updated");
                }
            });
        },
        eventClick: function(event) {
            if (confirm("Are you sure you want to remove it?")) {
                var id = event.id;
                $.ajax({
                    url: "/ajax_delete",
                    type: "POST",
                    data: { id: id },
                    success: function() {
                        calendar.fullCalendar('refetchEvents');
                        alert("Event Removed");
                    }
                });
            }
        }
    });
});
</script>

  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-size: cover;
      background-position: center;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header {
      width: 100%;
      background-color: #ffffff;
      padding: 20px;
      color: #324674;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #dee2e6;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-info span {
      font-weight: bold;
    }

    .header h1 {
      margin: 0;
    }

    .header .sign-out {
      background-color: #C83538;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.3s;
    }

    .header .sign-out:hover {
      background-color: #a62e30;
    }

    .main {
      flex: 1;
      display: flex;
    }

    .sidebar {
      width: 300px;
      background-color: #324674;
      padding: 20px;
      color: rgb(0, 0, 0);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }

    .sidebar h3 {
      color: #fff;
    }

    .sidebar form {
      display: flex;
      flex-direction: column;
    }

    .sidebar label {
      font-weight: bold;
      margin-top: 10px;
    }

    .sidebar input[type="text"],
    .sidebar input[type="datetime-local"] {
      padding: 10px;
      margin-top: 5px;
      border: none;
      border-radius: 5px;
      background-color: #f0f0f0;
    }

    .sidebar button {
      margin-top: 15px;
      padding: 10px;
      background-color: #C83538;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .sidebar button:hover {
      background-color: #a62e30;
    }

    .content {
      flex: 1;
      padding: 20px;
      background-color: #f5f5f5;
      overflow-y: auto;
    }

    #calendar {
      max-width: 100%;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Academic Calendar</h1>
    <div class="user-info">
      <span>Hi, {{ session.name }}</span>
      <a href="/logout" class="sign-out">Sign Out</a>
    </div>  
  </div>
  <div class="main">
    <div class="sidebar">
      <h3>Add Event</h3>
      <form action="/insert" method="POST">
        <label for="course">Course</label>
        <input type="text" id="title" name="title" placeholder="Enter the course" required>
        <label for="credits">Credits</label>
        <input type="text" id="title" name="title" placeholder="Enter the credits number" required>
        <label for="profname">Professor Name</label>
        <input type="text" id="profname" name="profname" placeholder="Enter the professor name" required>
        <label for="classroom">Classroom</label>
        <input type="text" id="classroom" name="classroom" placeholder="Enter the classroom" required>
        <label for="start">Start Time</label>
        <input type="datetime-local" id="start" name="start" required>
        <label for="end">End Time</label>
        <input type="datetime-local" id="end" name="end" required>
        <button type="submit">Save</button>
        <button type="reset" class="reset">Cancel</button>
      </form>
      <form action="/generate">
        <button type="submit">Generate Calendar</button>
      </form>
    </div>
    <div class="content">
      <div id="calendar"></div>
    </div>
  </div>
</body>
 </html>
